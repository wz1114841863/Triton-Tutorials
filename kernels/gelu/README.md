# 针对 RTX 3060 (Ampere 架构)
export TORCH_CUDA_ARCH_LIST="8.6"
标准公式

$GELU(x) = x \cdot P(X \le x) = x \cdot \Phi(x)= x \cdot \frac{1}{2} [1 + \text{erf}(\frac{x}{\sqrt{2}})]$

硬件近似

$GELU(x) \approx 0.5x(1 + \tanh[\sqrt{2/\pi}(x + 0.044715x^3)])$

此外，还实现了针对half的htanh指令：

tanh(x) = (e^2x - 1) / (e^2x + 1)

```
python ./relu.py
-------------------------------------------------------------------------------------
                                        S=1024, K=1024
           out_f32: ['0.0         ', '0.0         '], time:0.31274772ms
         out_f32x4: ['0.0         ', '0.0         '], time:0.30522370ms
        out_f32_th: ['0.0         ', '0.0         '], time:0.30476213ms
-------------------------------------------------------------------------------------
           out_f16: ['0.0         ', '0.0         '], time:0.14774561ms
         out_f16x2: ['0.0         ', '0.0         '], time:0.14556336ms
         out_f16x8: ['0.0         ', '0.0         '], time:0.13569665ms
     out_f16x8pack: ['0.0         ', '0.0         '], time:0.13551879ms
        out_f16_th: ['0.0         ', '0.0         '], time:0.14761424ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=1024, K=2048
           out_f32: ['0.08368108  ', '0.79084152  '], time:0.63049030ms
         out_f32x4: ['0.08368108  ', '0.79084152  '], time:0.62585187ms
        out_f32_th: ['0.08368108  ', '0.79084152  '], time:0.62520528ms
-------------------------------------------------------------------------------------
           out_f16: ['0.0836792   ', '0.79101562  '], time:0.31429648ms
         out_f16x2: ['0.0836792   ', '0.79101562  '], time:0.31307960ms
         out_f16x8: ['0.0836792   ', '0.79101562  '], time:0.30229402ms
     out_f16x8pack: ['0.0836792   ', '0.79101562  '], time:0.31130886ms
        out_f16_th: ['0.0836792   ', '0.79101562  '], time:0.31504512ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=1024, K=4096
           out_f32: ['1.57778072  ', '0.0         '], time:1.27651381ms
         out_f32x4: ['1.57778072  ', '0.0         '], time:1.26007032ms
        out_f32_th: ['1.57778072  ', '0.0         '], time:1.24866652ms
-------------------------------------------------------------------------------------
           out_f16: ['1.578125    ', '0.0         '], time:0.62856126ms
         out_f16x2: ['1.578125    ', '0.0         '], time:0.62899065ms
         out_f16x8: ['1.578125    ', '0.0         '], time:0.61183023ms
     out_f16x8pack: ['1.578125    ', '0.0         '], time:0.62441373ms
        out_f16_th: ['1.578125    ', '0.0         '], time:0.64687896ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=2048, K=1024
           out_f32: ['1.43983185  ', '1.0776937   '], time:0.63849235ms
         out_f32x4: ['1.43983185  ', '1.0776937   '], time:0.62506318ms
        out_f32_th: ['1.43983185  ', '1.0776937   '], time:0.62301850ms
-------------------------------------------------------------------------------------
           out_f16: ['1.43945312  ', '1.078125    '], time:0.30914259ms
         out_f16x2: ['1.43945312  ', '1.078125    '], time:0.31716132ms
         out_f16x8: ['1.43945312  ', '1.078125    '], time:0.30869341ms
     out_f16x8pack: ['1.43945312  ', '1.078125    '], time:0.30959177ms
        out_f16_th: ['1.43945312  ', '1.078125    '], time:0.30968690ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=2048, K=2048
           out_f32: ['0.0         ', '1.02945721  '], time:1.27837396ms
         out_f32x4: ['0.0         ', '1.02945721  '], time:1.28599143ms
        out_f32_th: ['0.0         ', '1.02945721  '], time:1.27698278ms
-------------------------------------------------------------------------------------
           out_f16: ['0.0         ', '1.02929688  '], time:0.63954377ms
         out_f16x2: ['0.0         ', '1.02929688  '], time:0.63318348ms
         out_f16x8: ['0.0         ', '1.02929688  '], time:0.61776900ms
     out_f16x8pack: ['0.0         ', '1.02929688  '], time:0.62774014ms
        out_f16_th: ['0.0         ', '1.02929688  '], time:0.63102365ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=2048, K=4096
           out_f32: ['0.15115149  ', '0.34621149  '], time:2.51278996ms
         out_f32x4: ['0.15115149  ', '0.34621149  '], time:2.52728987ms
        out_f32_th: ['0.15115149  ', '0.34621149  '], time:2.49340773ms
-------------------------------------------------------------------------------------
           out_f16: ['0.15112305  ', '0.34619141  '], time:2.10464168ms
         out_f16x2: ['0.15112305  ', '0.34619141  '], time:1.25318503ms
         out_f16x8: ['0.15112305  ', '0.34619141  '], time:1.21868563ms
     out_f16x8pack: ['0.15112305  ', '0.34619141  '], time:1.24989510ms
        out_f16_th: ['0.15112305  ', '0.34619141  '], time:1.25716710ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=4096, K=1024
           out_f32: ['0.0         ', '0.0         '], time:1.27829862ms
         out_f32x4: ['0.0         ', '0.0         '], time:1.27260947ms
        out_f32_th: ['0.0         ', '0.0         '], time:1.24401569ms
-------------------------------------------------------------------------------------
           out_f16: ['0.0         ', '0.0         '], time:0.62471628ms
         out_f16x2: ['0.0         ', '0.0         '], time:0.62906742ms
         out_f16x8: ['0.0         ', '0.0         '], time:0.61225367ms
     out_f16x8pack: ['0.0         ', '0.0         '], time:0.62787795ms
        out_f16_th: ['0.0         ', '0.0         '], time:0.63620329ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=4096, K=2048
           out_f32: ['1.101004    ', '0.0         '], time:2.55812216ms
         out_f32x4: ['1.101004    ', '0.0         '], time:2.54684496ms
        out_f32_th: ['1.101004    ', '0.0         '], time:2.52824283ms
-------------------------------------------------------------------------------------
           out_f16: ['1.10058594  ', '0.0         '], time:1.27629542ms
         out_f16x2: ['1.10058594  ', '0.0         '], time:1.26816511ms
         out_f16x8: ['1.10058594  ', '0.0         '], time:1.26718426ms
     out_f16x8pack: ['1.10058594  ', '0.0         '], time:1.28314567ms
        out_f16_th: ['1.10058594  ', '0.0         '], time:1.27269292ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=4096, K=4096
           out_f32: ['1.45916343  ', '0.20402084  '], time:5.44707108ms
         out_f32x4: ['1.45916343  ', '0.20402084  '], time:5.05713344ms
        out_f32_th: ['1.45916343  ', '0.20402084  '], time:5.01443100ms
-------------------------------------------------------------------------------------
           out_f16: ['1.45898438  ', '0.20397949  '], time:2.50126624ms
         out_f16x2: ['1.45898438  ', '0.20397949  '], time:2.50141668ms
         out_f16x8: ['1.45898438  ', '0.20397949  '], time:2.45983219ms
     out_f16x8pack: ['1.45898438  ', '0.20397949  '], time:2.50147319ms
        out_f16_th: ['1.45898438  ', '0.20397949  '], time:2.52020669ms
-------------------------------------------------------------------------------------
(triton) wz@DESKTOP-953MNSG:~/AI/Triton-Tutorials/kernels/relu$ cd ../gelu/
(triton) wz@DESKTOP-953MNSG:~/AI/Triton-Tutorials/kernels/gelu$ python ./gelu.py
-------------------------------------------------------------------------------------
                                        S=1024, K=1024
           out_f32: [1.68145013, -0.15183143], time:0.31526375ms
         out_f32x4: [1.68145013, -0.15183143], time:0.32014728ms
        out_f32_th: [1.68144596, -0.15183181], time:0.30952263ms
-------------------------------------------------------------------------------------
           out_f16: [1.68164062, -0.15185547], time:0.14960861ms
         out_f16x2: [1.68164062, -0.15185547], time:0.17435455ms
         out_f16x8: [1.68164062, -0.15185547], time:0.13982892ms
     out_f16x8pack: [1.68164062, -0.15185547], time:0.14455533ms
        out_f16_th: [1.68164062, -0.15185547], time:0.14952469ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=1024, K=2048
           out_f32: [-0.12992272, 1.36860514], time:0.64318705ms
         out_f32x4: [-0.12992272, 1.36860514], time:0.63059521ms
        out_f32_th: [-0.12992245, 1.36860931], time:0.62651420ms
-------------------------------------------------------------------------------------
           out_f16: [-0.12988281, 1.36816406], time:0.31537795ms
         out_f16x2: [-0.12988281, 1.36816406], time:0.31554294ms
         out_f16x8: [-0.12988281, 1.36816406], time:0.30539036ms
     out_f16x8pack: [-0.12988281, 1.36816406], time:0.30928659ms
        out_f16_th: [-0.12988281, 1.36914062], time:0.30742311ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=1024, K=4096
           out_f32: [-0.10611465, -0.16270708], time:1.26632142ms
         out_f32x4: [-0.10611465, -0.16270708], time:1.33379149ms
        out_f32_th: [-0.10611463, -0.16270532], time:1.35326552ms
-------------------------------------------------------------------------------------
           out_f16: [-0.10614014, -0.16296387], time:0.81935358ms
         out_f16x2: [-0.10614014, -0.16296387], time:1.29340243ms
         out_f16x8: [-0.10614014, -0.16296387], time:0.69263935ms
     out_f16x8pack: [-0.10614014, -0.16296387], time:0.68678951ms
        out_f16_th: [-0.10614014, -0.16271973], time:0.63820815ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=2048, K=1024
           out_f32: [1.4777534, -0.07106917], time:0.66616535ms
         out_f32x4: [1.4777534, -0.07106917], time:0.63010693ms
        out_f32_th: [1.47775567, -0.0710692], time:0.62757373ms
-------------------------------------------------------------------------------------
           out_f16: [1.47753906, -0.07104492], time:0.30788231ms
         out_f16x2: [1.47753906, -0.07104492], time:0.31668377ms
         out_f16x8: [1.47753906, -0.07104492], time:0.30230069ms
     out_f16x8pack: [1.47753906, -0.07104492], time:0.30707622ms
        out_f16_th: [1.47753906, -0.07104492], time:0.30761290ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=2048, K=2048
           out_f32: [0.41613963, 1.49440253], time:1.28531098ms
         out_f32x4: [0.41613963, 1.49440253], time:1.28025675ms
        out_f32_th: [0.41613972, 1.4944067], time:1.24115729ms
-------------------------------------------------------------------------------------
           out_f16: [0.41625977, 1.49414062], time:0.63566279ms
         out_f16x2: [0.41625977, 1.49414062], time:0.64137363ms
         out_f16x8: [0.41625977, 1.49414062], time:0.63800216ms
     out_f16x8pack: [0.41625977, 1.49414062], time:0.79484296ms
        out_f16_th: [0.41625977, 1.49414062], time:0.78258085ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=2048, K=4096
           out_f32: [-0.16773997, 1.10552955], time:3.03799534ms
         out_f32x4: [-0.16773997, 1.10552955], time:2.80061054ms
        out_f32_th: [-0.16774087, 1.10553038], time:2.53873992ms
-------------------------------------------------------------------------------------
           out_f16: [-0.16772461, 1.10546875], time:1.28165674ms
         out_f16x2: [-0.16772461, 1.10546875], time:1.29059386ms
         out_f16x8: [-0.16772461, 1.10546875], time:1.35957193ms
     out_f16x8pack: [-0.16772461, 1.10546875], time:1.28679919ms
        out_f16_th: [-0.16772461, 1.10546875], time:1.41884899ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=4096, K=1024
           out_f32: [-0.03272423, 0.24072872], time:1.51486254ms
         out_f32x4: [-0.03272423, 0.24072872], time:1.46239257ms
        out_f32_th: [-0.03272423, 0.24072908], time:1.46742749ms
-------------------------------------------------------------------------------------
           out_f16: [-0.03271484, 0.24084473], time:0.84298849ms
         out_f16x2: [-0.03271484, 0.24084473], time:0.63745213ms
         out_f16x8: [-0.03271484, 0.24084473], time:0.65338850ms
     out_f16x8pack: [-0.03271484, 0.24084473], time:0.66587758ms
        out_f16_th: [-0.03271484, 0.24072266], time:0.89303684ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=4096, K=2048
           out_f32: [-0.13310887, 0.20587051], time:3.09264708ms
         out_f32x4: [-0.13310887, 0.20587051], time:3.14587188ms
        out_f32_th: [-0.13310879, 0.20587015], time:2.81000662ms
-------------------------------------------------------------------------------------
           out_f16: [-0.13317871, 0.20593262], time:1.72811699ms
         out_f16x2: [-0.13317871, 0.20593262], time:1.28107548ms
         out_f16x8: [-0.13317871, 0.20593262], time:1.81768298ms
     out_f16x8pack: [-0.13317871, 0.20593262], time:1.92560554ms
        out_f16_th: [-0.13317871, 0.20593262], time:1.58805656ms
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
                                        S=4096, K=4096
           out_f32: [-0.01212267, 0.37867907], time:6.50591779ms
         out_f32x4: [-0.01212267, 0.37867907], time:5.31855845ms
        out_f32_th: [-0.01212267, 0.37867895], time:6.72685218ms
-------------------------------------------------------------------------------------
           out_f16: [-0.01212311, 0.37841797], time:3.14819336ms
         out_f16x2: [-0.01212311, 0.37841797], time:3.12446618ms
         out_f16x8: [-0.01212311, 0.37841797], time:2.55579162ms
     out_f16x8pack: [-0.01212311, 0.37841797], time:2.58606839ms
        out_f16_th: [-0.01212311, 0.37866211], time:2.59386802ms
-------------------------------------------------------------------------------------
```
